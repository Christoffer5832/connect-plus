package me.andreww7985.connectplus.helpers

object ChecksumHelper {
    private val crcTable = longArrayOf(0L, -613349823L, 1838353091L, -1226699646L, -618261114L, 5706695L, -1229643963L, 1841568004L, 1832725837L, -1236522228L, 11413390L, -606133809L, -1239729973L, 1835679370L, -611831288L, 16331849L, -629515622L, 17521883L, -1209446311L, 1821922840L, 22826780L, -634566307L, 1825523167L, -1212267618L, -1220053033L, 1815507350L, -623608556L, 27622229L, 1818321489L, -1223662576L, 32663698L, -628920621L, 1871033205L, -1259031244L, 35043766L, -647512073L, -1264343309L, 1876074674L, -651121616L, 37857905L, 45653560L, -641099655L, 1865127163L, -1269132614L, -643920962L, 49253887L, -1274183299L, 1870432060L, -1241519633L, 1854861230L, -663952596L, 52290925L, 1859779689L, -1247217112L, 55244458L, -667160341L, -658324318L, 62112483L, -1252929951L, 1847642144L, 65327396L, -661268635L, 1853348839L, -1257841242L, -552900886L, 75129003L, -1298633687L, 1776904808L, 70087532L, -547588819L, 1774090671L, -1295024146L, -1305064537L, 1766280678L, -542817948L, 81020709L, 1762680353L, -1302243232L, 75715810L, -537767261L, 91307120L, -570410447L, 1759655603L, -1282199310L, -564712970L, 86388663L, -1278991563L, 1756702068L, 1749815613L, -1287841924L, 98507774L, -559014465L, -1284897605L, 1746600698L, -554103176L, 92801081L, -1332816481L, 1811928030L, -585244836L, 107796765L, 1806221337L, -1327905192L, 104581850L, -582300517L, -575407918L, 113442451L, -1340018159L, 1800533072L, 110488916L, -572200171L, 1795614615L, -1334320682L, 1794412293L, -1316648636L, 124224966L, -602504313L, -1311597949L, 1789107394L, -599683008L, 120624641L, 130654792L, -591879159L, 1784326283L, -1322537270L, -588269618L, 127840655L, -1317225203L, 1779284812L, 1701301141L, -1105801772L, 150258006L, -746207465L, -1102979565L, 1697699922L, -741157680L, 144954001L, 140175064L, -752099175L, 1707731995L, -1095177638L, -746785954L, 135132447L, -1091569251L, 1704919004L, -1088581361L, 1684838222L, -762405940L, 167746957L, 1681622153L, -1085635896L, 162041418L, -757495797L, -769606590L, 156350979L, -1078741375L, 1690480832L, 151431620L, -763908219L, 1687528199L, -1075534522L, 182614240L, -778862943L, 1735488035L, -1140820894L, -775656090L, 179661607L, -1135122523L, 1730568676L, 1742689709L, -1129425940L, 172777326L, -784508625L, -1124515797L, 1736984170L, -781563160L, 169561257L, -795336070L, 199828539L, -1123342151L, 1719283448L, 197015548L, -791727683L, 1714240831L, -1118028930L, -1113256137L, 1725172086L, -801765900L, 189203381L, 1719868081L, -1108206352L, 185602162L, -798943693L, -1167282817L, 1629334334L, -671111236L, 210674173L, 1632286969L, -1170489672L, 215593530L, -676809605L, -682524622L, 203458163L, -1161655567L, 1639156912L, 209163700L, -687434763L, 1642372983L, -1164601034L, 1612117989L, -1150815836L, 226884902L, -688587929L, -1154424221L, 1614930978L, -693901152L, 231927521L, 220977832L, -698688279L, 1622724715L, -1144400342L, -703738066L, 226281839L, -1147222547L, 1626325932L, -706142710L, 244848715L, -1199958839L, 1661670024L, 248449932L, -708964915L, 1666974031L, -1205008626L, -1194052793L, 1671771398L, -716752508L, 238436293L, 1676814017L, -1199366016L, 241249282L, -720360893L, 261309584L, -723369263L, 1644187219L, -1183758318L, -726314730L, 264525655L, -1188668459L, 1649892756L, 1655597533L, -1176539236L, 255681310L, -733190817L, -1182237605L, 1660516890L, -736397672L, 258633945L)

    fun crc(input: ByteArray): Long {
        val array = ByteArray(input.size + 4, { -1 })
        System.arraycopy(input, 0, array, 4, input.size)

        var result = 0L
        for (i in array.size downTo 2 step 2) {
            result = updateCrc(result, (array[i - 2].toLong() and 0xFF))
            result = updateCrc(result, (array[i - 1].toLong() and 0xFF))
        }
        return result
    }

    private fun updateCrc(n: Long, n2: Long): Long {
        return 0xFFFFFFFFL and (n shl 8 xor crcTable[(0xFFL and (n shr 24)).toInt()] xor n2)
    }
}